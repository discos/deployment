---

- name: Copy the hosts file template
  become: True
  template:
    src: hosts
    dest: /etc/hosts
    mode: 0644


- name: Update hostname
  hostname:
    name: "{{ inventory_hostname }}"


- name: Update the local hosts file
  become: true
  local_action: lineinfile
  run_once: true
  args:
    dest: /etc/hosts
    regexp: "{{ hostvars[item].ansible_host }}"
    line: "{{ hostvars[item].ansible_host }} {{ hostvars[item].inventory_hostname }} {{ hostvars[item].inventory_hostname_short }}"
  with_items: "{{ play_hosts }}"


- name: Copy the firewall-reset template
  template:
    src: firewall-reset
    dest: "/usr/bin/"
    mode: 755
    force: yes
  become: true


- name: Add firewall-reset to startup executed scripts
  lineinfile:
    path: /etc/rc.d/rc.local
    line: firewall-reset
  become: true
